import{r as l,a as P,R as H}from"./vendor-DnjGVpDl.js";import{c as A}from"./supabase-BW5Qq1aw.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();var R={exports:{}},w={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D=l,J=Symbol.for("react.element"),z=Symbol.for("react.fragment"),W=Object.prototype.hasOwnProperty,$=D.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,K={key:!0,ref:!0,__self:!0,__source:!0};function C(t,s,i){var c,a={},r=null,d=null;i!==void 0&&(r=""+i),s.key!==void 0&&(r=""+s.key),s.ref!==void 0&&(d=s.ref);for(c in s)W.call(s,c)&&!K.hasOwnProperty(c)&&(a[c]=s[c]);if(t&&t.defaultProps)for(c in s=t.defaultProps,s)a[c]===void 0&&(a[c]=s[c]);return{$$typeof:J,type:t,key:r,ref:d,props:a,_owner:$.current}}w.Fragment=z;w.jsx=C;w.jsxs=C;R.exports=w;var e=R.exports,I={},S=P;I.createRoot=S.createRoot,I.hydrateRoot=S.hydrateRoot;const E="https://taqewgcljfalxzfojtwz.supabase.co",L="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhcWV3Z2NsamZhbHh6Zm9qdHd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NTEwNzgsImV4cCI6MjA3OTUyNzA3OH0.J67dUoRstYRgb9XHacit28_RIEQ8_pHvUeCe2YJYvvo",O=A(E,L);async function F(t,s,i,c){const{data:a,error:r}=await O.from("classifications").insert({image_url:t,predicted_class:s,confidence:i,model_used:c}).select().single();if(r)throw r;return a}async function G(t=50){const{data:s,error:i}=await O.from("classifications").select("*").order("created_at",{ascending:!1}).limit(t);if(i)throw i;return s}async function T(t){try{const s=await fetch(`${E}/functions/v1/classify-wayang`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:JSON.stringify({image:t})}),i=await s.json();if(!s.ok)throw new Error(i.error||i.message||"Classification failed");return i}catch(s){throw console.error("Classification API error:",s),new Error(s.message||"Failed to connect to classification service")}}async function U(t){throw console.log("TensorFlow.js not available, using server-side classification"),new Error("Use server-side classification")}function V({onResult:t}){const[s,i]=l.useState(null),[c,a]=l.useState(!1),[r,d]=l.useState(null),[m,p]=l.useState(null),[y,u]=l.useState(!1),[v,j]=l.useState(!0),x=l.useRef(null),N=l.useRef(null);l.useEffect(()=>((async()=>{j(!1),b()})(),()=>{s&&s.getTracks().forEach(h=>h.stop())}),[]);const b=async()=>{try{const n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:1280,height:720}});i(n),x.current&&(x.current.srcObject=n),p(null)}catch(n){console.error("Camera error:",n),p("Tidak dapat mengakses kamera. Pastikan izin kamera telah diberikan.")}},o=async()=>{if(!(!x.current||c))try{a(!0),d(null);const n=N.current,h=x.current;n.width=h.videoWidth,n.height=h.videoHeight,n.getContext("2d").drawImage(h,0,0);const g=n.toDataURL("image/jpeg",.7);let f;if(v&&y)f=await U(g);else{const M=g.split(",")[1];f=await T(M)}await F(g,f.predicted_class,f.confidence,f.model_used),d(f),t&&t(f)}catch(n){console.error("Classification error:",n),p("Gagal mengklasifikasi gambar. Silakan coba lagi.")}finally{a(!1)}};return m&&!s?e.jsx("div",{className:"camera-container",children:e.jsxs("div",{className:"camera-error",children:[e.jsx("p",{children:m}),e.jsx("button",{onClick:b,className:"retry-button",children:"Coba Lagi"})]})}):e.jsxs("div",{className:"camera-container",children:[e.jsxs("div",{className:"camera-view",children:[e.jsx("video",{ref:x,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video"}),e.jsx("canvas",{ref:N,style:{display:"none"}}),r&&e.jsx("div",{className:"result-overlay",children:e.jsxs("div",{className:"result-box",children:[e.jsx("h3",{children:r.predicted_class}),e.jsxs("p",{children:[(r.confidence*100).toFixed(1),"%"]})]})})]}),m&&e.jsx("div",{className:"error-message",children:m}),e.jsx("div",{className:"camera-controls",children:e.jsx("button",{onClick:o,disabled:c||!s,className:"capture-button",children:c?e.jsx("div",{className:"spinner"}):e.jsx("div",{className:"capture-icon"})})})]})}function _(){const[t,s]=l.useState(null),[i,c]=l.useState(null),[a,r]=l.useState(!1),[d,m]=l.useState(null),[p,y]=l.useState(!1),[u,v]=l.useState(!0),j=l.useRef(null);l.useEffect(()=>{(async()=>{v(!1)})()},[]);const x=async o=>{var k;const n=(k=o.target.files)==null?void 0:k[0];if(!n)return;if(!n.type.startsWith("image/")){m("File harus berupa gambar");return}const h=new FileReader;h.onload=async g=>{const f=g.target.result;s(f),c(null),m(null),await N(f)},h.readAsDataURL(n)},N=async o=>{try{r(!0),m(null);let n;if(u&&p)console.log("Using TensorFlow.js for classification"),n=await U(o);else{console.log("Using server-side classification");const h=o.split(",")[1];n=await T(h)}await F(o,n.predicted_class,n.confidence,n.model_used),c(n)}catch(n){console.error("Classification error:",n),m("Gagal mengklasifikasi gambar. Silakan coba lagi.")}finally{r(!1)}},b=()=>{var o;(o=j.current)==null||o.click()};return e.jsxs("div",{className:"image-picker-container",children:[e.jsx("input",{ref:j,type:"file",accept:"image/*",onChange:x,style:{display:"none"}}),!t&&e.jsxs("div",{className:"welcome-section",children:[e.jsx("div",{className:"welcome-icon",children:"ðŸŽ­"}),e.jsx("h2",{children:"Klasifikasi Wayang"}),e.jsx("p",{children:"Upload foto wayang untuk mengetahui nama dan informasi karakternya"})]}),e.jsx("button",{onClick:b,disabled:a,className:"upload-button",children:t?"ðŸ“· Pilih Gambar Lain":"ðŸ“¤ Upload Gambar Wayang"}),t&&e.jsx("div",{className:"image-preview",children:e.jsx("img",{src:t,alt:"Selected"})}),a&&e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Mengklasifikasi..."})]}),d&&e.jsx("div",{className:"error-message",children:d}),i&&!a&&e.jsxs("div",{className:"result-container",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("div",{className:"result-badge",children:"âœ¨"}),e.jsx("h2",{children:"Hasil Klasifikasi"})]}),e.jsxs("div",{className:"main-result",children:[e.jsxs("div",{className:"character-info",children:[e.jsx("h3",{className:"character-name",children:i.predicted_class}),i.description&&e.jsx("p",{className:"character-description",children:i.description})]}),e.jsxs("div",{className:"confidence-badge",children:[e.jsxs("span",{className:"confidence-value",children:[(i.confidence*100).toFixed(1),"%"]}),e.jsx("span",{className:"confidence-label",children:"Akurasi"})]})]}),i.all_predictions&&i.all_predictions.length>0&&e.jsxs("div",{className:"all-predictions",children:[e.jsx("h4",{children:"Kemungkinan Lainnya:"}),i.all_predictions.slice(0,5).map((o,n)=>e.jsxs("div",{className:"prediction-row",children:[e.jsxs("div",{className:"prediction-info",children:[e.jsx("span",{className:"prediction-class",children:o.class}),o.description&&e.jsx("span",{className:"prediction-desc",children:o.description})]}),e.jsxs("div",{className:"prediction-right",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${o.confidence*100}%`}})}),e.jsxs("span",{className:"prediction-confidence",children:[(o.confidence*100).toFixed(1),"%"]})]})]},n))]})]})]})}function Y(){const[t,s]=l.useState([]),[i,c]=l.useState(!0),[a,r]=l.useState(!1),[d,m]=l.useState(null);l.useEffect(()=>{p()},[]);const p=async()=>{try{c(!0),m(null);const u=await G(50);s(u)}catch(u){console.error("Error loading history:",u),m("Gagal memuat history")}finally{c(!1)}},y=async()=>{r(!0),await p(),r(!1)};return i?e.jsxs("div",{className:"history-container center",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Memuat history..."})]}):d?e.jsxs("div",{className:"history-container center",children:[e.jsx("p",{className:"error-text",children:d}),e.jsx("button",{onClick:p,className:"retry-button",children:"Coba Lagi"})]}):t.length===0?e.jsxs("div",{className:"history-container center",children:[e.jsx("p",{className:"empty-text",children:"Belum ada history klasifikasi"}),e.jsx("p",{className:"empty-subtext",children:"Mulai klasifikasi wayang untuk melihat history"})]}):e.jsxs("div",{className:"history-container",children:[e.jsxs("div",{className:"history-header",children:[e.jsx("h2",{children:"History Klasifikasi"}),e.jsx("button",{onClick:y,disabled:a,className:"refresh-button",children:a?"â†»":"ðŸ”„"})]}),e.jsx("div",{className:"history-list",children:t.map(u=>{const j=new Date(u.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"history-item",children:[e.jsx("img",{src:u.image_url,alt:u.predicted_class}),e.jsxs("div",{className:"item-details",children:[e.jsx("h3",{children:u.predicted_class}),e.jsxs("p",{className:"confidence",children:["Confidence: ",(u.confidence*100).toFixed(1),"%"]}),e.jsx("p",{className:"date",children:j})]})]},u.id)})})]})}function Z(){const[t,s]=l.useState("upload"),i=()=>{switch(t){case"camera":return e.jsx(V,{});case"upload":return e.jsx(_,{});case"history":return e.jsx(Y,{});default:return e.jsx(_,{})}};return e.jsxs("div",{className:"app",children:[e.jsx("header",{className:"app-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("div",{className:"logo-container",children:e.jsx("span",{className:"logo",children:"ðŸŽ­"})}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{children:"Klasifikasi Wayang"}),e.jsx("p",{children:"Kenali Tokoh Wayang dengan AI"})]})]})}),e.jsx("main",{className:"app-content",children:i()}),e.jsxs("nav",{className:"tab-bar",children:[e.jsxs("button",{className:`tab-button ${t==="camera"?"active":""}`,onClick:()=>s("camera"),children:[e.jsx("span",{className:"tab-icon",children:"ðŸ“¹"}),e.jsx("span",{className:"tab-text",children:"Scan"})]}),e.jsxs("button",{className:`tab-button ${t==="upload"?"active":""}`,onClick:()=>s("upload"),children:[e.jsx("span",{className:"tab-icon",children:"ðŸ“¤"}),e.jsx("span",{className:"tab-text",children:"Upload"})]}),e.jsxs("button",{className:`tab-button ${t==="history"?"active":""}`,onClick:()=>s("history"),children:[e.jsx("span",{className:"tab-icon",children:"ðŸ“‹"}),e.jsx("span",{className:"tab-text",children:"History"})]})]})]})}I.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(Z,{})}));
